
---

# **버퍼 오버플로우(Buffer Overflow)**
- 이용 악성 코드 삽입 및 해킹 시도 과정

## **🧠 1. 버퍼 오버플로우란?**

### ✅ **정상적인 메모리 동작**
```c
char buffer[8];
strcpy(buffer, "ABC");  // OK
```
- `buffer`는 스택 메모리에 올라가고 `"ABC"`는 정상적으로 들어갑니다.

### ❌ **비정상적인 입력**
```c
strcpy(buffer, "AAAAAAAAAAAAAAAAAAAA");
```
- `buffer` 크기는 8바이트인데 20바이트 데이터를 입력하면 **메모리 오버플로우 발생**.
- **리턴 주소(`return address`)까지 덮어쓸 수 있어 치명적인 보안 문제 발생!**

---

## **💣 2. 공격 흐름 (Exploit Flow)**

### **취약한 코드 예시**
```c
char buffer[8];
gets(buffer);  // 매우 위험 (버퍼 오버플로우 가능)
```

### **▶ 공격자가 입력하는 구조**
```
[패딩 데이터][쉘코드][리턴 주소 덮기]
```
예시:
```
AAAAAAAA  ← buffer
(shellcode) ← 악성 코드 삽입
RET 주소 ← 함수 리턴 주소를 공격자가 원하는 주소로 덮음
```

### **🛠 공격 결과**
- 함수가 끝나고 `return` 될 때, 덮여쓴 **리턴 주소**로 **점프**하여 **공격자가 삽입한 쉘코드가 실행됨**.

---

## **🛠 예제 그림 (스택 구조)**

```
[BUFFER (8 bytes)] ← "AAAA...."
[EBP] ← 함수 프레임 포인터
[RET] ← 함수가 return 될 주소
```

### **악성 입력**
```
AAAAAAAA[쉘코드][RET = 쉘코드 주소]
```
- 함수 종료 후 **RET → 공격자가 만든 쉘코드 실행!**

---

## **🐚 쉘코드(Shellcode)란?**
- **짧은 기계어 코드** (수십 바이트).
- **메모리 내에서 바로 실행 가능한 바이너리 코드**.
- 대표적인 예: **리버스 셸**, **시스템 명령 실행** (`/bin/sh` 등).

### **리눅스 쉘코드 예제**
```shell
\x31\xc0\x50\x68\x2f\x2f\x73\x68...
```
※ 위 코드는 **리눅스에서 `/bin/sh`를 실행하는 쉘코드**.

---

## **🔐 방어 방법들**

| **기법** | **설명** |
|-----------------|--------------------------------|
| ✅ `fgets()`, `strncpy()` | 안전한 문자열 입력 함수 사용 |
| ✅ 스택 카나리 (Stack Canary) | 리턴 주소 전에 랜덤값 삽입, 침범 탐지 |
| ✅ ASLR (주소 공간 배치 난수화) | 메모리 주소를 랜덤하게 배치하여 쉘코드 점프 방지 |
| ✅ DEP / NX (실행 방지 영역) | 데이터가 있는 메모리는 실행되지 않도록 설정 |
| ✅ 컴파일러 경고 `-Wall` | 취약 코드 컴파일 시 경고 확인 |

---

## **📦 실제 실습 가능 자료**
리눅스 환경에서 **gdb**, **objdump**, **pwndbg** 등을 활용해 해킹 흐름을 직접 디버깅할 수 있습니다.

- 예제 코드:
  - 취약한 C 프로그램 코드.
  - 쉘코드 삽입용 Python 스크립트.
- 고급 기법:
  - **ROP (Return Oriented Programming)** 기법 활용 가능.

🚀 실습을 원하면 예제 파일과 **gdb 튜토리얼**을 제공해드릴 수 있습니다!

---

## **✅ 정리 요약**

| **항목** | **내용** |
|----------------|--------------------------------|
| **공격 기법** | 버퍼를 넘치는 입력 → 리턴 주소 덮기 → 쉘코드 실행 |
| **목적** | 권한 탈취, 백도어 실행, 시스템 셸 획득 등 |
| **학습 가치** | 시스템 구조/메모리 관리 이해에 매우 중요 |
| **방어 전략** | 안전한 함수 사용 + 스택 보호 + 주소 랜덤화 적용 |

---


